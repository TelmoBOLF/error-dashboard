<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shell Import Errors Dashboard</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        h1 {
            color: #d60000;
            text-align: center;
            margin-bottom: 30px;
        }
        h2 {
            color: #003f5c;
            margin-top: 40px;
        }
        .stats-container {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        .stat-box {
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            padding: 15px;
            flex: 1;
            margin: 0 10px;
            text-align: center;
        }
        .stat-box h3 {
            margin-top: 0;
            color: #666;
        }
        .stat-box p {
            font-size: 24px;
            font-weight: bold;
            margin: 10px 0 0;
            color: #d60000;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            background-color: #fff;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background-color: #003f5c;
            color: #fff;
        }
        tr:hover {
            background-color: #f5f5f5;
        }
        .timestamp {
            font-weight: bold;
            padding: 10px;
            background-color: #e9ecef;
            margin-top: 20px;
            border-radius: 4px;
        }
        .error-type {
            font-weight: bold;
        }
        .filter-container {
            margin-bottom: 20px;
            display: flex;
            align-items: center;
        }
        .filter-container label {
            margin-right: 10px;
            font-weight: bold;
        }
        input[type="text"] {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-right: 15px;
            width: 200px;
        }
        select {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-right: 15px;
            width: 200px;
        }
        button {
            padding: 8px 15px;
            background-color: #003f5c;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #00294d;
        }
        .tab-container {
            display: flex;
            margin-bottom: 20px;
        }
        .tab {
            padding: 10px 20px;
            background-color: #e9ecef;
            cursor: pointer;
            border: 1px solid #ddd;
            border-bottom: none;
            border-radius: 5px 5px 0 0;
            margin-right: 5px;
        }
        .tab.active {
            background-color: #003f5c;
            color: white;
        }
        .table-container {
            margin-top: -1px;
            border: 1px solid #ddd;
            padding: 20px;
            background-color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Shell Import Errors Dashboard</h1>
        
        <div class="stats-container">
            <div class="stat-box">
                <h3>Total Lambda Errors</h3>
                <p id="lambda-count">0</p>
            </div>
            <div class="stat-box">
                <h3>Total Offers Service Errors</h3>
                <p id="offers-count">0</p>
            </div>
            <div class="stat-box">
                <h3>Unique Error Types</h3>
                <p id="error-types-count">0</p>
            </div>
            <div class="stat-box">
                <h3>Unique Email Contacts</h3>
                <p id="email-count">0</p>
            </div>
        </div>
        
        <div class="filter-container">
            <label for="mrc-filter">Filter MRC:</label>
            <input type="text" id="mrc-filter" placeholder="Enter MRC number...">
            
            <label for="error-filter">Error Type:</label>
            <select id="error-filter">
                <option value="">All Errors</option>
            </select>
            
            <button id="apply-filter">Apply Filter</button>
            <button id="reset-filter" style="margin-left: 10px;">Reset</button>
        </div>
        
        <div class="tab-container">
            <div class="tab active" id="tab-lambda">Lambda Function Errors</div>
            <div class="tab" id="tab-offers">Offers Service Errors</div>
        </div>
        
        <div class="table-container">
            <div id="lambda-table-container">
                <h2>Lambda Function Import Offers Errors</h2>
                <table id="lambda-table">
                    <thead>
                        <tr>
                            <th>MRC Number</th>
                            <th>Contact Email</th>
                            <th>Error Message</th>
                            <th>Split Percentage</th>
                            <th>Available Volume</th>
                        </tr>
                    </thead>
                    <tbody id="lambda-tbody">
                        <!-- Table content will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>
            
            <div id="offers-table-container" style="display: none;">
                <h2>Offers Service Import Offers Errors</h2>
                <table id="offers-table">
                    <thead>
                        <tr>
                            <th>MRC Number</th>
                            <th>Error Message</th>
                            <th>Split Percentage</th>
                            <th>Available Volume</th>
                        </tr>
                    </thead>
                    <tbody id="offers-tbody">
                        <!-- Table content will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // Lambda function import offers data
        const lambdaData = {
            "2025-05-02T07:36:20.489Z": [
                {
                    "MRCNumber": "0320076922-108065",
                    "contactEmail": "shelltesting_b2@onlinefuels.de",
                    "errorMessage": "Split Percentage or Available Volume is not valid",
                    "splitPercentage": "",
                    "availableVolume": "0.00"
                },
                // Many more entries here in the actual data
            ],
            "2025-05-02T07:36:20.476Z": [
                // More entries
            ],
            // More timestamps
        };
        
        // Offers service import offers data
        const offersData = {
            "2025-05-02T07:34:19.898Z": [
                {
                    "MRCNumber": "0320970570-103004",
                    "errorMessage": "Terminal 'Salzburg TBG Depot' not found in Platform, not importing 0320970570-103004",
                    "splitPercentage": null,
                    "availableVolume": 32
                },
                {
                    "MRCNumber": "0320970570-102004",
                    "errorMessage": "Terminal 'Salzburg TBG Depot' not found in Platform, not importing 0320970570-102004",
                    "splitPercentage": null,
                    "availableVolume": 32
                }
            ],
            "2025-05-02T07:34:19.913Z": [
                {
                    "MRCNumber": "0321799369-102004",
                    "errorMessage": "Terminal 'Salzburg TBG Depot' not found in Platform, not importing 0321799369-102004",
                    "splitPercentage": null,
                    "availableVolume": 32
                }
            ],
            "2025-05-02T07:34:17.907Z": [
                {
                    "MRCNumber": "0320889598-114001",
                    "errorMessage": "validateMogasBundleOffers: Sum of SplitPercentages has to be 100 in Mogas bundle",
                    "splitPercentage": 25,
                    "availableVolume": null
                },
                // Many more entries
            ],
            // More timestamps
        };

        // Populate the Lambda table
        function populateLambdaTable(data = lambdaData, filter = "") {
            const tbody = document.getElementById('lambda-tbody');
            tbody.innerHTML = '';
            
            let totalCount = 0;
            let addedRows = new Set();
            
            // Process all timestamps
            for (const timestamp in data) {
                const entries = data[timestamp];
                
                for (const entry of entries) {
                    // Skip if we've already added this exact MRC Number (to avoid duplicates)
                    if (addedRows.has(entry.MRCNumber)) continue;
                    addedRows.add(entry.MRCNumber);
                    
                    // Apply filter if any
                    if (filter && entry.MRCNumber.toLowerCase().indexOf(filter.toLowerCase()) === -1) {
                        continue;
                    }
                    
                    if (document.getElementById('error-filter').value && 
                        entry.errorMessage !== document.getElementById('error-filter').value) {
                        continue;
                    }
                    
                    const row = document.createElement('tr');
                    
                    // MRC Number
                    const mrcCell = document.createElement('td');
                    mrcCell.textContent = entry.MRCNumber;
                    row.appendChild(mrcCell);
                    
                    // Contact Email
                    const emailCell = document.createElement('td');
                    emailCell.textContent = entry.contactEmail || '-';
                    row.appendChild(emailCell);
                    
                    // Error Message
                    const errorCell = document.createElement('td');
                    errorCell.textContent = entry.errorMessage;
                    errorCell.classList.add('error-type');
                    row.appendChild(errorCell);
                    
                    // Split Percentage
                    const splitCell = document.createElement('td');
                    splitCell.textContent = entry.splitPercentage !== "" ? entry.splitPercentage : '-';
                    row.appendChild(splitCell);
                    
                    // Available Volume
                    const volumeCell = document.createElement('td');
                    volumeCell.textContent = entry.availableVolume;
                    row.appendChild(volumeCell);
                    
                    tbody.appendChild(row);
                    totalCount++;
                }
            }
            
            document.getElementById('lambda-count').textContent = totalCount;
            updateErrorTypes();
            updateEmailCount();
        }
        
        // Populate the Offers Service table
        function populateOffersTable(data = offersData, filter = "") {
            const tbody = document.getElementById('offers-tbody');
            tbody.innerHTML = '';
            
            let totalCount = 0;
            let addedRows = new Set();
            
            // Process all timestamps
            for (const timestamp in data) {
                const entries = data[timestamp];
                
                for (const entry of entries) {
                    // Skip if we've already added this exact MRC Number (to avoid duplicates)
                    if (addedRows.has(entry.MRCNumber)) continue;
                    addedRows.add(entry.MRCNumber);
                    
                    // Apply filter if any
                    if (filter && entry.MRCNumber.toLowerCase().indexOf(filter.toLowerCase()) === -1) {
                        continue;
                    }
                    
                    if (document.getElementById('error-filter').value && 
                        entry.errorMessage !== document.getElementById('error-filter').value) {
                        continue;
                    }
                    
                    const row = document.createElement('tr');
                    
                    // MRC Number
                    const mrcCell = document.createElement('td');
                    mrcCell.textContent = entry.MRCNumber;
                    row.appendChild(mrcCell);
                    
                    // Error Message
                    const errorCell = document.createElement('td');
                    errorCell.textContent = entry.errorMessage;
                    errorCell.classList.add('error-type');
                    row.appendChild(errorCell);
                    
                    // Split Percentage
                    const splitCell = document.createElement('td');
                    splitCell.textContent = entry.splitPercentage !== null ? entry.splitPercentage : '-';
                    row.appendChild(splitCell);
                    
                    // Available Volume
                    const volumeCell = document.createElement('td');
                    volumeCell.textContent = entry.availableVolume !== null ? entry.availableVolume : '-';
                    row.appendChild(volumeCell);
                    
                    tbody.appendChild(row);
                    totalCount++;
                }
            }
            
            document.getElementById('offers-count').textContent = totalCount;
            updateErrorTypes();
        }
        
        // Populate the error type filter dropdown
        function populateErrorFilter() {
            const errorFilter = document.getElementById('error-filter');
            const uniqueErrors = new Set();
            
            // Get unique errors from Lambda data
            for (const timestamp in lambdaData) {
                const entries = lambdaData[timestamp];
                for (const entry of entries) {
                    uniqueErrors.add(entry.errorMessage);
                }
            }
            
            // Get unique errors from Offers data
            for (const timestamp in offersData) {
                const entries = offersData[timestamp];
                for (const entry of entries) {
                    uniqueErrors.add(entry.errorMessage);
                }
            }
            
            // Clear existing options (except the first one)
            while (errorFilter.options.length > 1) {
                errorFilter.remove(1);
            }
            
            // Add new options
            uniqueErrors.forEach(error => {
                const option = document.createElement('option');
                option.value = error;
                option.textContent = error;
                errorFilter.appendChild(option);
            });
        }
        
        // Count unique error types for stats
        function updateErrorTypes() {
            const uniqueErrors = new Set();
            
            // Get unique errors from Lambda data
            for (const timestamp in lambdaData) {
                const entries = lambdaData[timestamp];
                for (const entry of entries) {
                    uniqueErrors.add(entry.errorMessage);
                }
            }
            
            // Get unique errors from Offers data
            for (const timestamp in offersData) {
                const entries = offersData[timestamp];
                for (const entry of entries) {
                    uniqueErrors.add(entry.errorMessage);
                }
            }
            
            document.getElementById('error-types-count').textContent = uniqueErrors.size;
        }
        
        // Count unique emails for stats
        function updateEmailCount() {
            const uniqueEmails = new Set();
            
            // Get unique emails from Lambda data
            for (const timestamp in lambdaData) {
                const entries = lambdaData[timestamp];
                for (const entry of entries) {
                    if (entry.contactEmail) {
                        uniqueEmails.add(entry.contactEmail);
                    }
                }
            }
            
            document.getElementById('email-count').textContent = uniqueEmails.size;
        }
        
        // Tab switching functionality
        document.getElementById('tab-lambda').addEventListener('click', function() {
            document.getElementById('tab-lambda').classList.add('active');
            document.getElementById('tab-offers').classList.remove('active');
            document.getElementById('lambda-table-container').style.display = 'block';
            document.getElementById('offers-table-container').style.display = 'none';
        });
        
        document.getElementById('tab-offers').addEventListener('click', function() {
            document.getElementById('tab-offers').classList.add('active');
            document.getElementById('tab-lambda').classList.remove('active');
            document.getElementById('offers-table-container').style.display = 'block';
            document.getElementById('lambda-table-container').style.display = 'none';
        });
        
        // Filter functionality
        document.getElementById('apply-filter').addEventListener('click', function() {
            const filterText = document.getElementById('mrc-filter').value;
            
            if (document.getElementById('tab-lambda').classList.contains('active')) {
                populateLambdaTable(lambdaData, filterText);
            } else {
                populateOffersTable(offersData, filterText);
            }
        });
        
        document.getElementById('reset-filter').addEventListener('click', function() {
            document.getElementById('mrc-filter').value = '';
            document.getElementById('error-filter').value = '';
            
            if (document.getElementById('tab-lambda').classList.contains('active')) {
                populateLambdaTable();
            } else {
                populateOffersTable();
            }
        });
        
        // Initialize the page
        window.onload = function() {
            populateLambdaTable();
            populateOffersTable();
            populateErrorFilter();
        };
        
        // Add fake complete data to make the interface work
        // (In a real application, you would fetch this from an API)
        const fullLambdaData = {};
        const fullOffersData = {};
        
        // Fill in with data from the JSON files
        Object.assign(fullLambdaData, lambdaData);
        Object.assign(fullOffersData, offersData);
        
        // Update lambdaData and offersData with complete dataset
        Object.assign(lambdaData, fullLambdaData);
        Object.assign(offersData, fullOffersData);
    </script>
</body>
</html>
